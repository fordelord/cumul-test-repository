# react-cumulio-dashboard

This is a React library for embedding [Cumul.io](https://cumul.io/main) dashboards in your React application.

## Table of contents

1. [Installation instructions](#installation-instructions)
2. [Usage](#usage)
3. [Events](#events)
4. [Public methods](#public-methods)
6. [Changelog](#changelog)
6. [Migration](#migration)
7. [Quick links](#quick-links)

## Installation instructions

```bash
npm i @cumul.io/react-cumulio-dashboard
```  

## Usage  

```ts
import { CumulioDashboardComponent, CumulioDashboard } from '@cumul.io/react-cumulio-dashboard';
import { useRef } from 'react';
...
  function CumulioWrapper() {
    const ref = useRef<CumulioDashboard>(null);
    return (
      <div className="App">
        <button
          onClick={async (e) => console.log(await ref.current.exportDashboard())}
        >
          Export Dashboard
        </button>
        <CumulioDashboardComponent
          ref={ref}
          authKey="<!-- your generated authKey -->"
          authToken="<!-- your generated authToken -->"
          dashboardSlug="test"
          switchScreenModeOnResize={false}
          loaderSpinnerColor="rgb(0, 81, 126)"
          loaderSpinnerBackground="rgb(236 248 255)"
          itemsRendered={(e) => console.log('itemsRendered', e)}>
        </CumulioDashboardComponent>
      </div>
    );
  }
...
```

**Properties**

Below a list of available properties on the dashboard react component

| Property                   | Type    | Description                                                                                                                                                                                                                                                                 |
|----------------------------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `dashboardId`              | string  | The id of the Cumul.io dashboard you wish to embed                                                                                                                                                                                                                          |
| `dashboardSlug`            | string  | The slug of the Cumul.io dashboard you wish to embed (if a dashboardId is supplied that one will be used)                                                                                                                                                                   |
| `itemId`                   | string  | The id of the Cumul.io item you wish to embed                                                                                                                                                                                                                               |
| `itemDimensions`                   | { width: number/string; height: number/string; }  | width and height of item only applies when itemId is provided. Accepts a JSON string.  |
| `authKey`                  | string  | Authorization key generated via Cumul.io API                                                                                                                                                                                                                                |
| `authToken`                | string  | Authorization token generated via Cumul.io API                                                                                                                                                                                                                              |
| `language`                 | string  | The language of the dashboard: eg. 'en' (Default: 'auto')                                                                                                                                                                                                                   |
| `screenMode`               | string  | The screen mode of your dashboard: 'mobile', 'tablet', 'desktop', 'largeScreen', 'fixed' or 'auto' (Default: 'auto')                                                                                                                                                        |
| `switchScreenModeOnResize` | boolean | true: the embedded dashboard can switch screenModes on resize of the container , false: Dashboard will keep the same screenMode (Default: true)                                                                                                                             |
| `loaderBackground`         | string  | Background color of the loader element (Default: '#f9f9f9')                                                                                                                                                                                                                 |
| `loaderFontColor`          | string  | Font color of the text of the loaders (Default: '#5a5a5a')                                                                                                                                                                                                                  |
| `loaderSpinnerColor`       | string  | Spinner color of the loader (Default: 'rgba(255, 165, 0, 0.7)')                                                                                                                                                                                                             |
| `loaderSpinnerBackground`  | string  | Background color of the spinner (Default: 'rgba(169, 169, 169, 0.14)')                                                                                                                                                                                                      |
| `appServer`                | string  | Tenancy of cumul.io to connect to (Default: 'https://app.cumul.io/' for US set appServer to 'https://app.us.cumul.io/')                                                                                                                                                     |
| `timezoneId`               | string  | The timezone you you wish to use in your dashboard. This timezone id needs to be a valid id that is available in the [IANA timezone database](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List), for example: Europe/Brussels or America/New_York.         |
| `apiHost`                  | string  | API server to connect to (Default: 'https://api.cumul.io/' for US set apiHost to 'https://api.us.cumul.io/')                                                                                                                                                                |
| `editMode`                 | string  | Specifies if the embedded dashboard should be editable or not. Accepted values: "view" , "editLimited" , "editFull" . Use "view" if you don't want the embedded dashboard to be editable. (Default: "view" )                                                                |
| `mainColor`                | string  | Optional override of the main color used in the whitelabeling of the embedded dashboard editor. If not provided, the main color of the whitelabeling colors set on the organization will be used. Should be specified as a string of rgb values (i.e. "rgb(50,50,50)").     |
| `accentColor`              | string  | Optional override of the accent color used in the whitelabeling of the embedded dashboard editor. If not provided, the accent color of the whitelabeling colors set on the organization will be used. Should be specified as a string of rgb values (i.e. "rgb(50,50,50)"). |

<br/><br/>

## Events

| Name           | Description                            | Event Arguments       |
|----------------|----------------------------------------|-----------------------|
| changedFilters | Emitted when filters are changed       | `ChangedFiltersEvent` |
| customEvent    | Emitted when a custom event is fired   | `CustomEvent`         |
| exported       | Emitted when export completes or fails | `ExportedEvent`       |
| itemsRendered  | Emitted when all items are rendered    | `ItemsRenderedEvent`  |
| load           | Emitted when dashboard is loaded       | `LoadEvent`           |

<br/>

## Public methods
```typescript
getDashboards(): Promise<CumulioDashboard[]>
// Returns an instantly resolved promise with an array of all the visible dashboards on a page with their information.

getData(itemId: string): Promise<ItemData>
// Promise that returns an array with the data of a item.
  
getFilters(): Promise<Filter[]>
// Promise that returns an array of filters.

setAuthorization(key: string, token: string): Promise<void>
// Sets a new pair of authKey & authToken for the dashboard

refreshData(itemId?: string): Promise<void>
// Refreshes the data of a specific item/chart when the id of that item is supplied. Without a itemId this refreshes the data in all items.

reloadDashboard(): Promise<void>
// Reloads the dashboard. (useful when the authorization is changed, and dashboard needs to be reloaded)

exportDashboard(type?: ExportType): Promise<ExportDashboard>
// Exports the current dashboard as either pdf or png.

getAccessibleDashboards(): Promise<AccessibleDashboard[]>
// Retrieves a list of all dashboards an integration has access to. authKey and authToken needs to be set for this function to work.

setEditMode(editMode: string): Promise<SetEditMode>
// Sets the editMode of the current dashboard. Accepted parameters: view , editLimited , editFull .
```  
<br/>

## Changelog
* [Changelog](https://cumulio-internal.github.io/embed-libraries/changelogs/react-cumulio-dashboard/)

## Migration

**Migration from 2.X.X to 3.X.X**  
- No Changes

**Migrating from 1.X.X to 2.X.X**
- All methods that were called on dispatched to store shall now be called on component ref (Which can be obtained using `useRef to obtain a ref`).
- `chartId` is now called `itemId`, `charts-rendered` is now called `items-rendered`
- All events are now of the format `{ data: { ...eventData } }`, `eventData` is of the format

```ts
{
  dashboardId?: string;
  dashboardSlug?: string;
  itemId?: string;
  language: string;
  name: string;
  screenMode: string;
  type: string;
  dimensions?: object; // populated depending on the event
  changed?: [];  // populated depending on the event
  filters?: [];  // populated depending on the event
  item?: string;    // populated depending on the event
  origin?: string;  // populated depending on the event
  object?: string;  // populated depending on the event
  data?: object;       // populated depending on the event
}
```

- getFilters now returns an array of filters. `[...objectOfFilters]`, `objectOfFilters` is of the format

```ts
[{
  expression: string;
  parameters: [];
  properties: {
    id: string;
    ignore?: string[];
    origin: string;
    type: string;
    viz: string;
  }
}]
```


## Quick links

[Cumul.io](https://cumul.io)
[Codesandbox example](https://codesandbox.io/s/react-cumulio-dashboard-jh91i)
