# Web Component for Cumul.io Dashboards

A modern [Web Component](https://developer.mozilla.org/en-US/docs/Web/Web_Components) for [Cumul.io](https://cumul.io/main) dashboards in your web application.

## Table of contents

1. [Installation instructions](#installation-instructions)
2. [Usage](#usage)
3. [Events](#events)
4. [Public Methods](#public-methods)
5. [Examples](#examples)
6. [Changelog](#changelog)
7. [Migration](#migration)
8. [Quick links](#quick-links)

## Installation instructions

### 1. Install the component from npm

```bash
npm i @cumul.io/cumulio-dashboard
```

### 2. Import the component

In a JavaScript module:

```bash
import '@cumul.io/cumulio-dashboard';
```

OR In an HTML page:

```html
<script type="module">
  import './node_modules/@cumul.io/cumulio-dashboard/cumulio-dashboard.esm.js';
</script>
```

OR

```html
<script
  type="module"
  src="./node_modules/@cumul.io/cumulio-dashboard/cumulio-dashboard.esm.js">
</script>
```

## Usage

Use the dashboard components as if they were native HTML tags. Use the id of the dashboard you wish to embed.
**In your HTML template.**

```html
<cumulio-dashboard
  dashboardId="55cfb99c-d602-492b-b192-6c15277fdb9a"
  language="en">
</cumulio-dashboard>

OR

<!-- Embed a item by passing the item id as well -->
<cumulio-dashboard
  dashboardId="55cfb99c-d602-492b-b192-6c15277fdb9a"
  itemId="59fe5bd7-5070-42f5-98f4-da7f931e316c">
</cumulio-dashboard>
```

**Properties:**

Below a list of available properties on the dashboard web component

| Property                   | Type    | Description                                                                                                                                                                                                                                                                 |
|----------------------------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `dashboardId`              | string  | The id of the Cumul.io dashboard you wish to embed                                                                                                                                                                                                                          |
| `dashboardSlug`            | string  | The slug of the Cumul.io dashboard you wish to embed (if a dashboardId is supplied that one will be used)                                                                                                                                                                   |
| `itemId`                   | string  | The id of the Cumul.io item you wish to embed                                                                                                                                                                                                                               |
| `itemDimensions`                   | { width: number/string; height: number/string; }  | width and height of item only applies when itemId is provided. Accepts a JSON string.  |
| `authKey`                  | string  | Authorization key generated via Cumul.io API                                                                                                                                                                                                                                |
| `authToken`                | string  | Authorization token generated via Cumul.io API                                                                                                                                                                                                                              |
| `language`                 | string  | The language of the dashboard: eg. 'en' (Default: 'auto')                                                                                                                                                                                                                   |
| `screenMode`               | string  | The screen mode of your dashboard: 'mobile', 'tablet', 'desktop', 'largeScreen', 'fixed' or 'auto' (Default: 'auto')                                                                                                                                                        |
| `switchScreenModeOnResize` | boolean | true: the embedded dashboard can switch screenModes on resize of the container , false: Dashboard will keep the same screenMode (Default: true)                                                                                                                             |
| `loaderBackground`         | string  | Background color of the loader element (Default: '#f9f9f9')                                                                                                                                                                                                                 |
| `loaderFontColor`          | string  | Font color of the text of the loaders (Default: '#5a5a5a')                                                                                                                                                                                                                  |
| `loaderSpinnerColor`       | string  | Spinner color of the loader (Default: 'rgba(255, 165, 0, 0.7)')                                                                                                                                                                                                             |
| `loaderSpinnerBackground`  | string  | Background color of the spinner (Default: 'rgba(169, 169, 169, 0.14)')                                                                                                                                                                                                      |
| `appServer`                | string  | Tenancy of cumul.io to connect to (Default: 'https://app.cumul.io/' for US set appServer to 'https://app.us.cumul.io/')                                                                                                                                                     |
| `timezoneId`               | string  | The timezone you you wish to use in your dashboard. This timezone id needs to be a valid id that is available in the [IANA timezone database](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List), for example: Europe/Brussels or America/New_York.         |
| `apiHost`                  | string  | API server to connect to (Default: 'https://api.cumul.io/' , for US set apiHost to 'https://api.us.cumul.io/')                                                                                                                                                              |
| `editMode`                 | string  | Specifies if the embedded dashboard should be editable or not. Accepted values: "view" , "editLimited" , "editFull" . Use "view" if you don't want the embedded dashboard to be editable. (Default: "view" )                                                                |
| `mainColor`                | string  | Optional override of the main color used in the whitelabeling of the embedded dashboard editor. If not provided, the main color of the whitelabeling colors set on the organization will be used. Should be specified as a string of rgb values (i.e. "rgb(50,50,50)").     |
| `accentColor`              | string  | Optional override of the accent color used in the whitelabeling of the embedded dashboard editor. If not provided, the accent color of the whitelabeling colors set on the organization will be used. Should be specified as a string of rgb values (i.e. "rgb(50,50,50)"). |

<br/><br/>

## Events

| Name           | Description                            | Event Arguments       |
|----------------|----------------------------------------|-----------------------|
| changedFilters | Emitted when filters are changed       | `ChangedFiltersEvent` |
| customEvent    | Emitted when a custom event is fired   | `CustomEvent`         |
| exported       | Emitted when export completes or fails | `ExportedEvent`       |
| itemsRendered  | Emitted when all items are rendered    | `ItemsRenderedEvent`  |
| load           | Emitted when dashboard is loaded       | `LoadEvent`           |

<br/>

## Public methods

```typescript
getDashboards(): Promise<CumulioDashboard[]>
// Returns an instantly resolved promise with an array of all the visible dashboards on a page with their information.

getData(itemId: string): Promise<ItemData>
// Returns an array the data of a chart of a certain dashboard by adding the dashboardId or the container of the iframe.

getFilters(): Promise<Filter[]>
// Returns an array of active filters.

setAuthorization(key: string, token: string): Promise<void>
// Changes the authorization of all or one dashboard and refreshes the data of those dashboards.

refreshData(itemId?: string): Promise<void>
// Refreshes the data of a specific chart when the id of that item is supplied. Without a itemId this refreshes the data in all items.

reloadDashboard(): Promise<void>
// Reload the dashboard. (useful when the authorization is changed, and dashboard needs to be reloaded without reloading the iFrame)

exportDashboard(type?: ExportType): Promise<ExportDashboard>
// Exports the current dashboard as either pdf or png. A container class needs to be passed as an argument and an optional type parameter.

getAccessibleDashboards(): Promise<AccessibleDashboard[]>
// Get accessible dashboards in a integration, make sure 'apiHost', 'authKey', 'authToken' are set correctly on the instance.  

setEditMode(editMode: DashboardEditMode): Promise<SetEditMode>
// Sets the editMode of the current dashboard. Accepted parameters: "view" , "editLimited" , "editFull".
```
<br/>

## Examples

A dashboard with a gray loader background

```html
<cumulio-dashboard
  dashboardId="035c0304-0bfe-4b7c-8c10-a4acb8eb9d76"
  loaderBackground="rgb(238,243,246)">
</cumulio-dashboard>
```

A secured dashboard using an [authorization key & token](https://developer.cumul.io/#quickstart)

```html
<cumulio-dashboard
  dashboardId="035c0304-0bfe-4b7c-8c10-a4acb8eb9d76"
  authKey="<!-- your generated authKey-->"
  authToken="<!-- your generated authToken -->">
</cumulio-dashboard>
```

A dashboard with a purple spinner color of the loader with screenMode="mobile" and switchScreenModeOnResize=false, so that the dashboard will stay in mobile mode

```html
<cumulio-dashboard
  id="dashboard"
  dashboardId="55cfb99c-d602-492b-b192-6c15277fdb9a"
  loaderSpinnerColor="purple"
  screenMode="mobile"
  switchScreenModeOnResize="false">
</cumulio-dashboard>
```

Add an event listener when all items are rendered

```typescript
// get the component, here we query the component that has an id 'dashboard'
const dashboardComponent = document.getElementById('dashboard');
dashboardComponent.addEventListener('itemsRendered', (event) => {
  // do something after all items are rendered
  console.log(event);
});
```

Get data from an item

```typescript
dashboardComponent
  .getData('59fe5bd7-5070-42f5-98f4-da7f931e316c')
  .then((data) => {
    // do something with the item data
    console.log('Item data', data);
  });
```

Get filters used in the dashboard

```typescript
dashboardComponent
  .getFilters()
  .then((data) => {
    // do something with the item data
    console.log('Item data', data);
});
```

Export the dashboard

```typescript
dashboardComponent
  .exportDashboard('png')
  .then((data) => {
    // do something with the item data
    console.log('Item data', data);
});
```

Get accessible dashboards of an integration

```typescript
dashboardComponent
  .getAccessibleDashboards()
  .then((dashboards) => {
    // do something with the dashboards
    console.log('Accessible dashboards', dashboards);
});
```

## Changelog
* [Changelog](https://cumulio-internal.github.io/embed-libraries/changelogs/cumulio-dashboard/)

## Migration 

**From cumulio-dashboard-1.x.x to cumulio-dashboard-2.x.x**

- No Changes.

## Quick links

[Cumul.io](https://cumul.io) |
[Demo - Sample Integration](https://cumul.io/sample-integration) |
[Codesandbox example](https://codesandbox.io/s/cumulio-dashboard-kybwc)
